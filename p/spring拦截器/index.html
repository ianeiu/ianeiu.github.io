<!DOCTYPE html>
<html lang="zh-CN">
    <head><meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1'><meta name='description' content='å‰è¨€ æ¥åˆ°ä¸€ä¸ªéœ€æ±‚ï¼Œå°†å·²å¼€å‘å®Œæˆçš„ç³»ç»Ÿæ¥å…¥æƒé™ç³»ç»Ÿã€‚å…¶ä¸­éœ€è¦åœ¨å¤šå¤„è¯·æ±‚è¿”å›çš„ModelAndViewä¸­æ·»åŠ æƒé™ä»£ç é›†åˆï¼Œæ–¹ä¾¿æ˜¾ç¤ºå±‚åšèœå•æŒ‰é’®çš„æ˜¾ç¤ºæ§åˆ¶ã€‚æ‰€ä»¥å½“æ—¶æƒ³æ³•æ˜¯æ–°å»ºä¸€ä¸ªæ‹¦æˆªå™¨å¯¹è¿™å‡ ä¸ªè¯·æ±‚åšç»Ÿä¸€å¤„ç†ï¼ˆæ”¾å…¥æƒé™ä»£ç é›†åˆï¼‰ï¼Œç±»ä¼¼ä¹‹å‰é¡¹ç›®çš„é”™è¯¯é¡µé¢æ‹¦æˆªå™¨ã€‚
æ‹¦æˆªå™¨ç®€ä»‹ Spring æ¡†æ¶å®ç°æ‹¦æˆªå™¨åŠŸèƒ½ä¸»è¦æœ‰ä¸¤ç§æ–¹æ³•ï¼Œç¬¬ä¸€ç§æ˜¯å®ç°HandlerInterceptoræ¥å£ï¼Œç¬¬äºŒç§æ˜¯å®ç°WebRequestInterceptoræ¥å£ã€‚
HandlerInterceptoræ¥å£é€šè¿‡å®ç°HandlerInterceptoræ¥å£ï¼Œé‡å†™æ–¹æ³•preHandle()ã€postHandle()å’ŒafterCompletion()æ‹¦æˆªè¯·æ±‚ã€‚Spring æ¡†æ¶ä¸­è¿˜æä¾›äº†å¦å¤–ä¸€ä¸ªæ¥å£å’Œä¸€ä¸ªæŠ½è±¡ç±»ï¼Œå®ç°äº†å¯¹HandlerInterceptoræ¥å£çš„åŠŸèƒ½æ‰©å±•ï¼Œåˆ†åˆ«ä¸ºï¼šAsyncHandlerInterceptorå’ŒHandlerInterceptorAdapterã€‚
å¯¹äºAsyncHandlerInterceptoræ¥å£ï¼Œå…¶åœ¨ç»§æ‰¿HandlerInterceptoræ¥å£çš„åŒæ—¶ï¼Œåˆå£°æ˜äº†ä¸€ä¸ªæ–°çš„æ–¹æ³•afterConcurrentHandlingStarted()ï¼›
è€ŒHandlerInterceptorAdapteræŠ½è±¡ç±»ï¼Œåœ¨å…¶ç»§æ‰¿AsyncHandlerInterceptoræ¥å£çš„åŒæ—¶ï¼Œåˆå¤å†™äº†preHandleæ–¹æ³•ã€‚
 preHandle(HttpServletRequest request, HttpServletResponse response, Object handle)æ–¹æ³•ï¼Œè¯¥æ–¹æ³•åœ¨è¯·æ±‚å¤„ç†ä¹‹å‰è¿›è¡Œè°ƒç”¨ã€‚SpringMVC ä¸­çš„ Interceptor æ˜¯é“¾å¼è°ƒç”¨çš„ï¼Œåœ¨ä¸€ä¸ªåº”ç”¨ä¸­æˆ–è€…è¯´æ˜¯åœ¨ä¸€ä¸ªè¯·æ±‚ä¸­å¯ä»¥åŒæ—¶å­˜åœ¨å¤šä¸ª Interceptor ã€‚æ¯ä¸ª Interceptor çš„è°ƒç”¨ä¼šä¾æ®å®ƒçš„å£°æ˜é¡ºåºä¾æ¬¡æ‰§è¡Œï¼Œè€Œä¸”æœ€å…ˆæ‰§è¡Œçš„éƒ½æ˜¯ Interceptor ä¸­çš„ preHandle æ–¹æ³•ï¼Œæ‰€ä»¥å¯ä»¥åœ¨è¿™ä¸ªæ–¹æ³•ä¸­è¿›è¡Œä¸€äº›å‰ç½®åˆå§‹åŒ–æ“ä½œæˆ–è€…æ˜¯å¯¹å½“å‰è¯·æ±‚åšä¸€ä¸ªé¢„å¤„ç†ï¼Œä¹Ÿå¯ä»¥åœ¨è¿™ä¸ªæ–¹æ³•ä¸­è¿›è¡Œä¸€äº›åˆ¤æ–­æ¥å†³å®šè¯·æ±‚æ˜¯å¦è¦ç»§ç»­è¿›è¡Œä¸‹å»ã€‚è¯¥æ–¹æ³•çš„è¿”å›å€¼æ˜¯å¸ƒå°”å€¼ Boolean ç±»å‹çš„ï¼Œå½“å®ƒè¿”å›ä¸º false æ—¶ï¼Œè¡¨ç¤ºè¯·æ±‚ç»“æŸï¼Œåç»­çš„ Interceptor å’Œ Controller éƒ½ä¸ä¼šå†æ‰§è¡Œï¼›å½“è¿”å›å€¼ä¸º true æ—¶ï¼Œå°±ä¼šç»§ç»­è°ƒç”¨ä¸‹ä¸€ä¸ª Interceptor çš„ preHandle æ–¹æ³•ï¼Œå¦‚æœå·²ç»æ˜¯æœ€åä¸€ä¸ª Interceptor çš„æ—¶å€™ï¼Œå°±ä¼šæ˜¯è°ƒç”¨å½“å‰è¯·æ±‚çš„ Controller ä¸­çš„æ–¹æ³•ã€‚ postHandle(HttpServletRequest request, HttpServletResponse response, Object handle, ModelAndView modelAndView)æ–¹æ³•ï¼Œé€šè¿‡ preHandle æ–¹æ³•çš„è§£é‡Šå’±ä»¬çŸ¥é“è¿™ä¸ªæ–¹æ³•åŒ…æ‹¬åé¢è¦è¯´åˆ°çš„ afterCompletion æ–¹æ³•éƒ½åªèƒ½åœ¨å½“å‰æ‰€å±çš„ Interceptor çš„ preHandle æ–¹æ³•çš„è¿”å›å€¼ä¸º true çš„æ—¶å€™ï¼Œæ‰èƒ½è¢«è°ƒç”¨ã€‚postHandle æ–¹æ³•åœ¨å½“å‰è¯·æ±‚è¿›è¡Œå¤„ç†ä¹‹åï¼Œä¹Ÿå°±æ˜¯åœ¨ Controller ä¸­çš„æ–¹æ³•è°ƒç”¨ä¹‹åæ‰§è¡Œï¼Œä½†æ˜¯å®ƒä¼šåœ¨ DispatcherServlet è¿›è¡Œè§†å›¾è¿”å›æ¸²æŸ“ä¹‹å‰è¢«è°ƒç”¨ï¼Œæ‰€ä»¥å’±ä»¬å¯ä»¥åœ¨è¿™ä¸ªæ–¹æ³•ä¸­å¯¹ Controller å¤„ç†ä¹‹åçš„ ModelAndView å¯¹è±¡è¿›è¡Œæ“ä½œã€‚postHandle æ–¹æ³•è¢«è°ƒç”¨çš„æ–¹å‘è·Ÿ preHandle æ˜¯ç›¸åçš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå…ˆå£°æ˜çš„ Interceptor çš„ postHandle æ–¹æ³•åè€Œä¼šåæ‰§è¡Œã€‚è¿™å’Œ Struts2 é‡Œé¢çš„ Interceptor çš„æ‰§è¡Œè¿‡ç¨‹æœ‰ç‚¹ç±»å‹ï¼ŒStruts2 é‡Œé¢çš„ Interceptor çš„æ‰§è¡Œè¿‡ç¨‹ä¹Ÿæ˜¯é“¾å¼çš„ï¼Œåªæ˜¯åœ¨ Struts2 é‡Œé¢éœ€è¦æ‰‹åŠ¨è°ƒç”¨ ActionInvocation çš„ invoke æ–¹æ³•æ¥è§¦å‘å¯¹ä¸‹ä¸€ä¸ª Interceptor æˆ–è€…æ˜¯ action çš„è°ƒç”¨ï¼Œç„¶åæ¯ä¸€ä¸ª Interceptor ä¸­åœ¨ invoke æ–¹æ³•è°ƒç”¨ä¹‹å‰çš„å†…å®¹éƒ½æ˜¯æŒ‰ç…§å£°æ˜é¡ºåºæ‰§è¡Œçš„ï¼Œè€Œ invoke æ–¹æ³•ä¹‹åçš„å†…å®¹å°±æ˜¯åå‘çš„ã€‚ afterCompletion(HttpServletRequest request, HttpServletResponse response, Object handle, Exception ex)æ–¹æ³•ï¼Œä¹Ÿæ˜¯éœ€è¦å½“å‰å¯¹åº”çš„ Interceptor çš„ preHandle æ–¹æ³•çš„è¿”å›å€¼ä¸º true æ—¶æ‰ä¼šæ‰§è¡Œã€‚å› æ­¤ï¼Œè¯¥æ–¹æ³•å°†åœ¨æ•´ä¸ªè¯·æ±‚ç»“æŸä¹‹åï¼Œä¹Ÿå°±æ˜¯åœ¨ DispatcherServlet æ¸²æŸ“äº†å¯¹åº”çš„è§†å›¾ä¹‹åæ‰§è¡Œï¼Œè¿™ä¸ªæ–¹æ³•çš„ä¸»è¦ä½œç”¨æ˜¯ç”¨äºè¿›è¡Œèµ„æºæ¸…ç†çš„å·¥ä½œã€‚  WebRequestInterceptoræ¥å£åœ¨WebRequestInterceptoræ¥å£ä¸­ä¹Ÿå®šä¹‰äº† 3 ä¸ªæ–¹æ³•ï¼Œæ–¹æ³•ååŒHandlerInterceptoræ¥å£ç›¸åŒï¼Œ3 ä¸ªæ–¹æ³•éƒ½ä¼ é€’äº†åŒä¸€ä¸ªå‚æ•° WebRequestã€‚WebRequest æ˜¯ Spring ä¸­å®šä¹‰çš„ä¸€ä¸ªæ¥å£ï¼Œå®ƒé‡Œé¢çš„æ–¹æ³•å®šä¹‰è·Ÿ HttpServletRequest ç±»ä¼¼ï¼Œåœ¨WebRequestInterceptorä¸­å¯¹ WebRequest è¿›è¡Œçš„æ‰€æœ‰æ“ä½œéƒ½å°†åŒæ­¥åˆ° HttpServletRequest ä¸­ï¼Œç„¶ååœ¨å½“å‰è¯·æ±‚ä¸­ä¾æ¬¡ä¼ é€’ã€‚'><title>Springæ‹¦æˆªå™¨</title>

<link rel='canonical' href='https://ianeiu.github.io/p/spring%E6%8B%A6%E6%88%AA%E5%99%A8/'>

<link rel="stylesheet" href="/scss/style.min.css"><meta property='og:title' content='Springæ‹¦æˆªå™¨'>
<meta property='og:description' content='å‰è¨€ æ¥åˆ°ä¸€ä¸ªéœ€æ±‚ï¼Œå°†å·²å¼€å‘å®Œæˆçš„ç³»ç»Ÿæ¥å…¥æƒé™ç³»ç»Ÿã€‚å…¶ä¸­éœ€è¦åœ¨å¤šå¤„è¯·æ±‚è¿”å›çš„ModelAndViewä¸­æ·»åŠ æƒé™ä»£ç é›†åˆï¼Œæ–¹ä¾¿æ˜¾ç¤ºå±‚åšèœå•æŒ‰é’®çš„æ˜¾ç¤ºæ§åˆ¶ã€‚æ‰€ä»¥å½“æ—¶æƒ³æ³•æ˜¯æ–°å»ºä¸€ä¸ªæ‹¦æˆªå™¨å¯¹è¿™å‡ ä¸ªè¯·æ±‚åšç»Ÿä¸€å¤„ç†ï¼ˆæ”¾å…¥æƒé™ä»£ç é›†åˆï¼‰ï¼Œç±»ä¼¼ä¹‹å‰é¡¹ç›®çš„é”™è¯¯é¡µé¢æ‹¦æˆªå™¨ã€‚
æ‹¦æˆªå™¨ç®€ä»‹ Spring æ¡†æ¶å®ç°æ‹¦æˆªå™¨åŠŸèƒ½ä¸»è¦æœ‰ä¸¤ç§æ–¹æ³•ï¼Œç¬¬ä¸€ç§æ˜¯å®ç°HandlerInterceptoræ¥å£ï¼Œç¬¬äºŒç§æ˜¯å®ç°WebRequestInterceptoræ¥å£ã€‚
HandlerInterceptoræ¥å£é€šè¿‡å®ç°HandlerInterceptoræ¥å£ï¼Œé‡å†™æ–¹æ³•preHandle()ã€postHandle()å’ŒafterCompletion()æ‹¦æˆªè¯·æ±‚ã€‚Spring æ¡†æ¶ä¸­è¿˜æä¾›äº†å¦å¤–ä¸€ä¸ªæ¥å£å’Œä¸€ä¸ªæŠ½è±¡ç±»ï¼Œå®ç°äº†å¯¹HandlerInterceptoræ¥å£çš„åŠŸèƒ½æ‰©å±•ï¼Œåˆ†åˆ«ä¸ºï¼šAsyncHandlerInterceptorå’ŒHandlerInterceptorAdapterã€‚
å¯¹äºAsyncHandlerInterceptoræ¥å£ï¼Œå…¶åœ¨ç»§æ‰¿HandlerInterceptoræ¥å£çš„åŒæ—¶ï¼Œåˆå£°æ˜äº†ä¸€ä¸ªæ–°çš„æ–¹æ³•afterConcurrentHandlingStarted()ï¼›
è€ŒHandlerInterceptorAdapteræŠ½è±¡ç±»ï¼Œåœ¨å…¶ç»§æ‰¿AsyncHandlerInterceptoræ¥å£çš„åŒæ—¶ï¼Œåˆå¤å†™äº†preHandleæ–¹æ³•ã€‚
 preHandle(HttpServletRequest request, HttpServletResponse response, Object handle)æ–¹æ³•ï¼Œè¯¥æ–¹æ³•åœ¨è¯·æ±‚å¤„ç†ä¹‹å‰è¿›è¡Œè°ƒç”¨ã€‚SpringMVC ä¸­çš„ Interceptor æ˜¯é“¾å¼è°ƒç”¨çš„ï¼Œåœ¨ä¸€ä¸ªåº”ç”¨ä¸­æˆ–è€…è¯´æ˜¯åœ¨ä¸€ä¸ªè¯·æ±‚ä¸­å¯ä»¥åŒæ—¶å­˜åœ¨å¤šä¸ª Interceptor ã€‚æ¯ä¸ª Interceptor çš„è°ƒç”¨ä¼šä¾æ®å®ƒçš„å£°æ˜é¡ºåºä¾æ¬¡æ‰§è¡Œï¼Œè€Œä¸”æœ€å…ˆæ‰§è¡Œçš„éƒ½æ˜¯ Interceptor ä¸­çš„ preHandle æ–¹æ³•ï¼Œæ‰€ä»¥å¯ä»¥åœ¨è¿™ä¸ªæ–¹æ³•ä¸­è¿›è¡Œä¸€äº›å‰ç½®åˆå§‹åŒ–æ“ä½œæˆ–è€…æ˜¯å¯¹å½“å‰è¯·æ±‚åšä¸€ä¸ªé¢„å¤„ç†ï¼Œä¹Ÿå¯ä»¥åœ¨è¿™ä¸ªæ–¹æ³•ä¸­è¿›è¡Œä¸€äº›åˆ¤æ–­æ¥å†³å®šè¯·æ±‚æ˜¯å¦è¦ç»§ç»­è¿›è¡Œä¸‹å»ã€‚è¯¥æ–¹æ³•çš„è¿”å›å€¼æ˜¯å¸ƒå°”å€¼ Boolean ç±»å‹çš„ï¼Œå½“å®ƒè¿”å›ä¸º false æ—¶ï¼Œè¡¨ç¤ºè¯·æ±‚ç»“æŸï¼Œåç»­çš„ Interceptor å’Œ Controller éƒ½ä¸ä¼šå†æ‰§è¡Œï¼›å½“è¿”å›å€¼ä¸º true æ—¶ï¼Œå°±ä¼šç»§ç»­è°ƒç”¨ä¸‹ä¸€ä¸ª Interceptor çš„ preHandle æ–¹æ³•ï¼Œå¦‚æœå·²ç»æ˜¯æœ€åä¸€ä¸ª Interceptor çš„æ—¶å€™ï¼Œå°±ä¼šæ˜¯è°ƒç”¨å½“å‰è¯·æ±‚çš„ Controller ä¸­çš„æ–¹æ³•ã€‚ postHandle(HttpServletRequest request, HttpServletResponse response, Object handle, ModelAndView modelAndView)æ–¹æ³•ï¼Œé€šè¿‡ preHandle æ–¹æ³•çš„è§£é‡Šå’±ä»¬çŸ¥é“è¿™ä¸ªæ–¹æ³•åŒ…æ‹¬åé¢è¦è¯´åˆ°çš„ afterCompletion æ–¹æ³•éƒ½åªèƒ½åœ¨å½“å‰æ‰€å±çš„ Interceptor çš„ preHandle æ–¹æ³•çš„è¿”å›å€¼ä¸º true çš„æ—¶å€™ï¼Œæ‰èƒ½è¢«è°ƒç”¨ã€‚postHandle æ–¹æ³•åœ¨å½“å‰è¯·æ±‚è¿›è¡Œå¤„ç†ä¹‹åï¼Œä¹Ÿå°±æ˜¯åœ¨ Controller ä¸­çš„æ–¹æ³•è°ƒç”¨ä¹‹åæ‰§è¡Œï¼Œä½†æ˜¯å®ƒä¼šåœ¨ DispatcherServlet è¿›è¡Œè§†å›¾è¿”å›æ¸²æŸ“ä¹‹å‰è¢«è°ƒç”¨ï¼Œæ‰€ä»¥å’±ä»¬å¯ä»¥åœ¨è¿™ä¸ªæ–¹æ³•ä¸­å¯¹ Controller å¤„ç†ä¹‹åçš„ ModelAndView å¯¹è±¡è¿›è¡Œæ“ä½œã€‚postHandle æ–¹æ³•è¢«è°ƒç”¨çš„æ–¹å‘è·Ÿ preHandle æ˜¯ç›¸åçš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå…ˆå£°æ˜çš„ Interceptor çš„ postHandle æ–¹æ³•åè€Œä¼šåæ‰§è¡Œã€‚è¿™å’Œ Struts2 é‡Œé¢çš„ Interceptor çš„æ‰§è¡Œè¿‡ç¨‹æœ‰ç‚¹ç±»å‹ï¼ŒStruts2 é‡Œé¢çš„ Interceptor çš„æ‰§è¡Œè¿‡ç¨‹ä¹Ÿæ˜¯é“¾å¼çš„ï¼Œåªæ˜¯åœ¨ Struts2 é‡Œé¢éœ€è¦æ‰‹åŠ¨è°ƒç”¨ ActionInvocation çš„ invoke æ–¹æ³•æ¥è§¦å‘å¯¹ä¸‹ä¸€ä¸ª Interceptor æˆ–è€…æ˜¯ action çš„è°ƒç”¨ï¼Œç„¶åæ¯ä¸€ä¸ª Interceptor ä¸­åœ¨ invoke æ–¹æ³•è°ƒç”¨ä¹‹å‰çš„å†…å®¹éƒ½æ˜¯æŒ‰ç…§å£°æ˜é¡ºåºæ‰§è¡Œçš„ï¼Œè€Œ invoke æ–¹æ³•ä¹‹åçš„å†…å®¹å°±æ˜¯åå‘çš„ã€‚ afterCompletion(HttpServletRequest request, HttpServletResponse response, Object handle, Exception ex)æ–¹æ³•ï¼Œä¹Ÿæ˜¯éœ€è¦å½“å‰å¯¹åº”çš„ Interceptor çš„ preHandle æ–¹æ³•çš„è¿”å›å€¼ä¸º true æ—¶æ‰ä¼šæ‰§è¡Œã€‚å› æ­¤ï¼Œè¯¥æ–¹æ³•å°†åœ¨æ•´ä¸ªè¯·æ±‚ç»“æŸä¹‹åï¼Œä¹Ÿå°±æ˜¯åœ¨ DispatcherServlet æ¸²æŸ“äº†å¯¹åº”çš„è§†å›¾ä¹‹åæ‰§è¡Œï¼Œè¿™ä¸ªæ–¹æ³•çš„ä¸»è¦ä½œç”¨æ˜¯ç”¨äºè¿›è¡Œèµ„æºæ¸…ç†çš„å·¥ä½œã€‚  WebRequestInterceptoræ¥å£åœ¨WebRequestInterceptoræ¥å£ä¸­ä¹Ÿå®šä¹‰äº† 3 ä¸ªæ–¹æ³•ï¼Œæ–¹æ³•ååŒHandlerInterceptoræ¥å£ç›¸åŒï¼Œ3 ä¸ªæ–¹æ³•éƒ½ä¼ é€’äº†åŒä¸€ä¸ªå‚æ•° WebRequestã€‚WebRequest æ˜¯ Spring ä¸­å®šä¹‰çš„ä¸€ä¸ªæ¥å£ï¼Œå®ƒé‡Œé¢çš„æ–¹æ³•å®šä¹‰è·Ÿ HttpServletRequest ç±»ä¼¼ï¼Œåœ¨WebRequestInterceptorä¸­å¯¹ WebRequest è¿›è¡Œçš„æ‰€æœ‰æ“ä½œéƒ½å°†åŒæ­¥åˆ° HttpServletRequest ä¸­ï¼Œç„¶ååœ¨å½“å‰è¯·æ±‚ä¸­ä¾æ¬¡ä¼ é€’ã€‚'>
<meta property='og:url' content='https://ianeiu.github.io/p/spring%E6%8B%A6%E6%88%AA%E5%99%A8/'>
<meta property='og:site_name' content='å´ç‚œæ£‰'>
<meta property='og:type' content='article'><meta property='article:section' content='Post' /><meta property='article:tag' content='Spring' /><meta property='article:published_time' content='2018-10-30T00:00:00&#43;00:00'/><meta property='article:modified_time' content='2018-10-30T00:00:00&#43;00:00'/>
<meta name="twitter:title" content="Springæ‹¦æˆªå™¨">
<meta name="twitter:description" content="å‰è¨€ æ¥åˆ°ä¸€ä¸ªéœ€æ±‚ï¼Œå°†å·²å¼€å‘å®Œæˆçš„ç³»ç»Ÿæ¥å…¥æƒé™ç³»ç»Ÿã€‚å…¶ä¸­éœ€è¦åœ¨å¤šå¤„è¯·æ±‚è¿”å›çš„ModelAndViewä¸­æ·»åŠ æƒé™ä»£ç é›†åˆï¼Œæ–¹ä¾¿æ˜¾ç¤ºå±‚åšèœå•æŒ‰é’®çš„æ˜¾ç¤ºæ§åˆ¶ã€‚æ‰€ä»¥å½“æ—¶æƒ³æ³•æ˜¯æ–°å»ºä¸€ä¸ªæ‹¦æˆªå™¨å¯¹è¿™å‡ ä¸ªè¯·æ±‚åšç»Ÿä¸€å¤„ç†ï¼ˆæ”¾å…¥æƒé™ä»£ç é›†åˆï¼‰ï¼Œç±»ä¼¼ä¹‹å‰é¡¹ç›®çš„é”™è¯¯é¡µé¢æ‹¦æˆªå™¨ã€‚
æ‹¦æˆªå™¨ç®€ä»‹ Spring æ¡†æ¶å®ç°æ‹¦æˆªå™¨åŠŸèƒ½ä¸»è¦æœ‰ä¸¤ç§æ–¹æ³•ï¼Œç¬¬ä¸€ç§æ˜¯å®ç°HandlerInterceptoræ¥å£ï¼Œç¬¬äºŒç§æ˜¯å®ç°WebRequestInterceptoræ¥å£ã€‚
HandlerInterceptoræ¥å£é€šè¿‡å®ç°HandlerInterceptoræ¥å£ï¼Œé‡å†™æ–¹æ³•preHandle()ã€postHandle()å’ŒafterCompletion()æ‹¦æˆªè¯·æ±‚ã€‚Spring æ¡†æ¶ä¸­è¿˜æä¾›äº†å¦å¤–ä¸€ä¸ªæ¥å£å’Œä¸€ä¸ªæŠ½è±¡ç±»ï¼Œå®ç°äº†å¯¹HandlerInterceptoræ¥å£çš„åŠŸèƒ½æ‰©å±•ï¼Œåˆ†åˆ«ä¸ºï¼šAsyncHandlerInterceptorå’ŒHandlerInterceptorAdapterã€‚
å¯¹äºAsyncHandlerInterceptoræ¥å£ï¼Œå…¶åœ¨ç»§æ‰¿HandlerInterceptoræ¥å£çš„åŒæ—¶ï¼Œåˆå£°æ˜äº†ä¸€ä¸ªæ–°çš„æ–¹æ³•afterConcurrentHandlingStarted()ï¼›
è€ŒHandlerInterceptorAdapteræŠ½è±¡ç±»ï¼Œåœ¨å…¶ç»§æ‰¿AsyncHandlerInterceptoræ¥å£çš„åŒæ—¶ï¼Œåˆå¤å†™äº†preHandleæ–¹æ³•ã€‚
 preHandle(HttpServletRequest request, HttpServletResponse response, Object handle)æ–¹æ³•ï¼Œè¯¥æ–¹æ³•åœ¨è¯·æ±‚å¤„ç†ä¹‹å‰è¿›è¡Œè°ƒç”¨ã€‚SpringMVC ä¸­çš„ Interceptor æ˜¯é“¾å¼è°ƒç”¨çš„ï¼Œåœ¨ä¸€ä¸ªåº”ç”¨ä¸­æˆ–è€…è¯´æ˜¯åœ¨ä¸€ä¸ªè¯·æ±‚ä¸­å¯ä»¥åŒæ—¶å­˜åœ¨å¤šä¸ª Interceptor ã€‚æ¯ä¸ª Interceptor çš„è°ƒç”¨ä¼šä¾æ®å®ƒçš„å£°æ˜é¡ºåºä¾æ¬¡æ‰§è¡Œï¼Œè€Œä¸”æœ€å…ˆæ‰§è¡Œçš„éƒ½æ˜¯ Interceptor ä¸­çš„ preHandle æ–¹æ³•ï¼Œæ‰€ä»¥å¯ä»¥åœ¨è¿™ä¸ªæ–¹æ³•ä¸­è¿›è¡Œä¸€äº›å‰ç½®åˆå§‹åŒ–æ“ä½œæˆ–è€…æ˜¯å¯¹å½“å‰è¯·æ±‚åšä¸€ä¸ªé¢„å¤„ç†ï¼Œä¹Ÿå¯ä»¥åœ¨è¿™ä¸ªæ–¹æ³•ä¸­è¿›è¡Œä¸€äº›åˆ¤æ–­æ¥å†³å®šè¯·æ±‚æ˜¯å¦è¦ç»§ç»­è¿›è¡Œä¸‹å»ã€‚è¯¥æ–¹æ³•çš„è¿”å›å€¼æ˜¯å¸ƒå°”å€¼ Boolean ç±»å‹çš„ï¼Œå½“å®ƒè¿”å›ä¸º false æ—¶ï¼Œè¡¨ç¤ºè¯·æ±‚ç»“æŸï¼Œåç»­çš„ Interceptor å’Œ Controller éƒ½ä¸ä¼šå†æ‰§è¡Œï¼›å½“è¿”å›å€¼ä¸º true æ—¶ï¼Œå°±ä¼šç»§ç»­è°ƒç”¨ä¸‹ä¸€ä¸ª Interceptor çš„ preHandle æ–¹æ³•ï¼Œå¦‚æœå·²ç»æ˜¯æœ€åä¸€ä¸ª Interceptor çš„æ—¶å€™ï¼Œå°±ä¼šæ˜¯è°ƒç”¨å½“å‰è¯·æ±‚çš„ Controller ä¸­çš„æ–¹æ³•ã€‚ postHandle(HttpServletRequest request, HttpServletResponse response, Object handle, ModelAndView modelAndView)æ–¹æ³•ï¼Œé€šè¿‡ preHandle æ–¹æ³•çš„è§£é‡Šå’±ä»¬çŸ¥é“è¿™ä¸ªæ–¹æ³•åŒ…æ‹¬åé¢è¦è¯´åˆ°çš„ afterCompletion æ–¹æ³•éƒ½åªèƒ½åœ¨å½“å‰æ‰€å±çš„ Interceptor çš„ preHandle æ–¹æ³•çš„è¿”å›å€¼ä¸º true çš„æ—¶å€™ï¼Œæ‰èƒ½è¢«è°ƒç”¨ã€‚postHandle æ–¹æ³•åœ¨å½“å‰è¯·æ±‚è¿›è¡Œå¤„ç†ä¹‹åï¼Œä¹Ÿå°±æ˜¯åœ¨ Controller ä¸­çš„æ–¹æ³•è°ƒç”¨ä¹‹åæ‰§è¡Œï¼Œä½†æ˜¯å®ƒä¼šåœ¨ DispatcherServlet è¿›è¡Œè§†å›¾è¿”å›æ¸²æŸ“ä¹‹å‰è¢«è°ƒç”¨ï¼Œæ‰€ä»¥å’±ä»¬å¯ä»¥åœ¨è¿™ä¸ªæ–¹æ³•ä¸­å¯¹ Controller å¤„ç†ä¹‹åçš„ ModelAndView å¯¹è±¡è¿›è¡Œæ“ä½œã€‚postHandle æ–¹æ³•è¢«è°ƒç”¨çš„æ–¹å‘è·Ÿ preHandle æ˜¯ç›¸åçš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå…ˆå£°æ˜çš„ Interceptor çš„ postHandle æ–¹æ³•åè€Œä¼šåæ‰§è¡Œã€‚è¿™å’Œ Struts2 é‡Œé¢çš„ Interceptor çš„æ‰§è¡Œè¿‡ç¨‹æœ‰ç‚¹ç±»å‹ï¼ŒStruts2 é‡Œé¢çš„ Interceptor çš„æ‰§è¡Œè¿‡ç¨‹ä¹Ÿæ˜¯é“¾å¼çš„ï¼Œåªæ˜¯åœ¨ Struts2 é‡Œé¢éœ€è¦æ‰‹åŠ¨è°ƒç”¨ ActionInvocation çš„ invoke æ–¹æ³•æ¥è§¦å‘å¯¹ä¸‹ä¸€ä¸ª Interceptor æˆ–è€…æ˜¯ action çš„è°ƒç”¨ï¼Œç„¶åæ¯ä¸€ä¸ª Interceptor ä¸­åœ¨ invoke æ–¹æ³•è°ƒç”¨ä¹‹å‰çš„å†…å®¹éƒ½æ˜¯æŒ‰ç…§å£°æ˜é¡ºåºæ‰§è¡Œçš„ï¼Œè€Œ invoke æ–¹æ³•ä¹‹åçš„å†…å®¹å°±æ˜¯åå‘çš„ã€‚ afterCompletion(HttpServletRequest request, HttpServletResponse response, Object handle, Exception ex)æ–¹æ³•ï¼Œä¹Ÿæ˜¯éœ€è¦å½“å‰å¯¹åº”çš„ Interceptor çš„ preHandle æ–¹æ³•çš„è¿”å›å€¼ä¸º true æ—¶æ‰ä¼šæ‰§è¡Œã€‚å› æ­¤ï¼Œè¯¥æ–¹æ³•å°†åœ¨æ•´ä¸ªè¯·æ±‚ç»“æŸä¹‹åï¼Œä¹Ÿå°±æ˜¯åœ¨ DispatcherServlet æ¸²æŸ“äº†å¯¹åº”çš„è§†å›¾ä¹‹åæ‰§è¡Œï¼Œè¿™ä¸ªæ–¹æ³•çš„ä¸»è¦ä½œç”¨æ˜¯ç”¨äºè¿›è¡Œèµ„æºæ¸…ç†çš„å·¥ä½œã€‚  WebRequestInterceptoræ¥å£åœ¨WebRequestInterceptoræ¥å£ä¸­ä¹Ÿå®šä¹‰äº† 3 ä¸ªæ–¹æ³•ï¼Œæ–¹æ³•ååŒHandlerInterceptoræ¥å£ç›¸åŒï¼Œ3 ä¸ªæ–¹æ³•éƒ½ä¼ é€’äº†åŒä¸€ä¸ªå‚æ•° WebRequestã€‚WebRequest æ˜¯ Spring ä¸­å®šä¹‰çš„ä¸€ä¸ªæ¥å£ï¼Œå®ƒé‡Œé¢çš„æ–¹æ³•å®šä¹‰è·Ÿ HttpServletRequest ç±»ä¼¼ï¼Œåœ¨WebRequestInterceptorä¸­å¯¹ WebRequest è¿›è¡Œçš„æ‰€æœ‰æ“ä½œéƒ½å°†åŒæ­¥åˆ° HttpServletRequest ä¸­ï¼Œç„¶ååœ¨å½“å‰è¯·æ±‚ä¸­ä¾æ¬¡ä¼ é€’ã€‚">
    </head>
    <body class="">
    <script>
        (function() {
            const colorSchemeKey = 'StackColorScheme';
            if(!localStorage.getItem(colorSchemeKey)){
                localStorage.setItem(colorSchemeKey, "auto");
            }
        })();
    </script><script>
    (function() {
        const colorSchemeKey = 'StackColorScheme';
        const colorSchemeItem = localStorage.getItem(colorSchemeKey);
        const supportDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches === true;

        if (colorSchemeItem == 'dark' || colorSchemeItem === 'auto' && supportDarkMode) {
            

            document.body.dataset.scheme = 'dark';
        } else {
            document.body.dataset.scheme = 'light';
        }
    })();
</script><div class="container flex on-phone--column extended article-page with-toolbar">
            <aside class="sidebar left-sidebar sticky">
    <button class="hamburger hamburger--spin" type="button" id="toggle-menu" aria-label="Toggle Menu">
        <span class="hamburger-box">
            <span class="hamburger-inner"></span>
        </span>
    </button>

    <header class="site-info">
        
            <figure class="site-avatar">
                
                    
                    
                    
                        
                        <img src="/img/favicon_hu9c25eba29d1b5f1ed1a07b121643ba3c_344027_300x0_resize_box_2.png" width="300"
                            height="300" class="site-logo" loading="lazy" alt="Avatar">
                    
                

                
                    <span class="emoji">ğŸ‰</span>
                
            </figure>
        
        <h1 class="site-name"><a href="https://ianeiu.github.io">å´ç‚œæ£‰</a></h1>
        <h2 class="site-description">å¾—ä¹‹æˆ‘å¹¸</h2>
    </header>

    <ol class="menu" id="main-menu">
        
        
        

        <li >
            <a href='/'>
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <polyline points="5 12 3 12 12 3 21 12 19 12" />
  <path d="M5 12v7a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-7" />
  <path d="M9 21v-6a2 2 0 0 1 2 -2h2a2 2 0 0 1 2 2v6" />
</svg>



                
                <span>Home</span>
            </a>
        </li>
        
        

        <li >
            <a href='/about'>
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="7" r="4" />
  <path d="M6 21v-2a4 4 0 0 1 4 -4h4a4 4 0 0 1 4 4v2" />
</svg>



                
                <span>About</span>
            </a>
        </li>
        
        

        <li >
            <a href='/archives'>
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <rect x="3" y="4" width="18" height="4" rx="2" />
  <path d="M5 8v10a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-10" />
  <line x1="10" y1="12" x2="14" y2="12" />
</svg>



                
                <span>Archives</span>
            </a>
        </li>
        
        

        <li >
            <a href='/search'>
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="10" cy="10" r="7" />
  <line x1="21" y1="21" x2="15" y2="15" />
</svg>



                
                <span>Search</span>
            </a>
        </li>
        

        
            <li id="dark-mode-toggle">
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="8" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="16" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                <span>Dark Mode</span>
            </li>
        
    </ol>
</aside>

            <main class="main full-width">
    <div id="article-toolbar">
        <a href="https://ianeiu.github.io" class="back-home">
            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-chevron-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <polyline points="15 6 9 12 15 18" />
</svg>



            <span>Back</span>
        </a>
    </div>

    <article class="main-article">
    <header class="article-header">

    <div class="article-details">
    
    <header class="article-category">
        
            <a href="/categories/spring/" >
                Spring
            </a>
        
    </header>
    

    <h2 class="article-title">
        <a href="/p/spring%E6%8B%A6%E6%88%AA%E5%99%A8/">Springæ‹¦æˆªå™¨</a>
    </h2>

    <footer class="article-time">
        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <polyline points="12 7 12 12 15 15" />
</svg>



        <time class="article-time--published">Oct 30, 2018</time>
    </footer></div>
</header>

    <section class="article-content">
    <h2 id="å‰è¨€">å‰è¨€</h2>
<p>æ¥åˆ°ä¸€ä¸ªéœ€æ±‚ï¼Œå°†å·²å¼€å‘å®Œæˆçš„ç³»ç»Ÿæ¥å…¥æƒé™ç³»ç»Ÿã€‚å…¶ä¸­éœ€è¦åœ¨å¤šå¤„è¯·æ±‚è¿”å›çš„ModelAndViewä¸­æ·»åŠ æƒé™ä»£ç é›†åˆï¼Œæ–¹ä¾¿æ˜¾ç¤ºå±‚åšèœå•æŒ‰é’®çš„æ˜¾ç¤ºæ§åˆ¶ã€‚æ‰€ä»¥å½“æ—¶æƒ³æ³•æ˜¯æ–°å»ºä¸€ä¸ªæ‹¦æˆªå™¨å¯¹è¿™å‡ ä¸ªè¯·æ±‚åšç»Ÿä¸€å¤„ç†ï¼ˆæ”¾å…¥æƒé™ä»£ç é›†åˆï¼‰ï¼Œç±»ä¼¼ä¹‹å‰é¡¹ç›®çš„é”™è¯¯é¡µé¢æ‹¦æˆªå™¨ã€‚</p>
<h2 id="æ‹¦æˆªå™¨ç®€ä»‹">æ‹¦æˆªå™¨ç®€ä»‹</h2>
<p>Spring æ¡†æ¶å®ç°æ‹¦æˆªå™¨åŠŸèƒ½ä¸»è¦æœ‰ä¸¤ç§æ–¹æ³•ï¼Œç¬¬ä¸€ç§æ˜¯å®ç°<code>HandlerInterceptor</code>æ¥å£ï¼Œç¬¬äºŒç§æ˜¯å®ç°<code>WebRequestInterceptor</code>æ¥å£ã€‚</p>
<p><!-- raw HTML omitted -->HandlerInterceptoræ¥å£<!-- raw HTML omitted --></p>
<p>é€šè¿‡å®ç°HandlerInterceptoræ¥å£ï¼Œé‡å†™æ–¹æ³•<code>preHandle()</code>ã€<code>postHandle()</code>å’Œ<code>afterCompletion()</code>æ‹¦æˆªè¯·æ±‚ã€‚Spring æ¡†æ¶ä¸­è¿˜æä¾›äº†å¦å¤–ä¸€ä¸ªæ¥å£å’Œä¸€ä¸ªæŠ½è±¡ç±»ï¼Œå®ç°äº†å¯¹HandlerInterceptoræ¥å£çš„åŠŸèƒ½æ‰©å±•ï¼Œåˆ†åˆ«ä¸ºï¼šAsyncHandlerInterceptorå’ŒHandlerInterceptorAdapterã€‚</p>
<p>å¯¹äºAsyncHandlerInterceptoræ¥å£ï¼Œå…¶åœ¨ç»§æ‰¿HandlerInterceptoræ¥å£çš„åŒæ—¶ï¼Œåˆå£°æ˜äº†ä¸€ä¸ªæ–°çš„æ–¹æ³•<code>afterConcurrentHandlingStarted()</code>ï¼›<br>
è€ŒHandlerInterceptorAdapteræŠ½è±¡ç±»ï¼Œåœ¨å…¶ç»§æ‰¿AsyncHandlerInterceptoræ¥å£çš„åŒæ—¶ï¼Œåˆå¤å†™äº†preHandleæ–¹æ³•ã€‚</p>
<ul>
<li><code>preHandle(HttpServletRequest request, HttpServletResponse response, Object handle)</code>æ–¹æ³•ï¼Œè¯¥æ–¹æ³•åœ¨è¯·æ±‚å¤„ç†ä¹‹å‰è¿›è¡Œè°ƒç”¨ã€‚SpringMVC ä¸­çš„ Interceptor æ˜¯é“¾å¼è°ƒç”¨çš„ï¼Œåœ¨ä¸€ä¸ªåº”ç”¨ä¸­æˆ–è€…è¯´æ˜¯åœ¨ä¸€ä¸ªè¯·æ±‚ä¸­å¯ä»¥åŒæ—¶å­˜åœ¨å¤šä¸ª Interceptor ã€‚æ¯ä¸ª Interceptor çš„è°ƒç”¨ä¼šä¾æ®å®ƒçš„å£°æ˜é¡ºåºä¾æ¬¡æ‰§è¡Œï¼Œè€Œä¸”æœ€å…ˆæ‰§è¡Œçš„éƒ½æ˜¯ Interceptor ä¸­çš„ preHandle æ–¹æ³•ï¼Œæ‰€ä»¥å¯ä»¥åœ¨è¿™ä¸ªæ–¹æ³•ä¸­è¿›è¡Œä¸€äº›å‰ç½®åˆå§‹åŒ–æ“ä½œæˆ–è€…æ˜¯å¯¹å½“å‰è¯·æ±‚åšä¸€ä¸ªé¢„å¤„ç†ï¼Œä¹Ÿå¯ä»¥åœ¨è¿™ä¸ªæ–¹æ³•ä¸­è¿›è¡Œä¸€äº›åˆ¤æ–­æ¥å†³å®šè¯·æ±‚æ˜¯å¦è¦ç»§ç»­è¿›è¡Œä¸‹å»ã€‚è¯¥æ–¹æ³•çš„è¿”å›å€¼æ˜¯å¸ƒå°”å€¼ Boolean ç±»å‹çš„ï¼Œå½“å®ƒè¿”å›ä¸º false æ—¶ï¼Œè¡¨ç¤ºè¯·æ±‚ç»“æŸï¼Œåç»­çš„ Interceptor å’Œ Controller éƒ½ä¸ä¼šå†æ‰§è¡Œï¼›å½“è¿”å›å€¼ä¸º true æ—¶ï¼Œå°±ä¼šç»§ç»­è°ƒç”¨ä¸‹ä¸€ä¸ª Interceptor çš„ preHandle æ–¹æ³•ï¼Œå¦‚æœå·²ç»æ˜¯æœ€åä¸€ä¸ª Interceptor çš„æ—¶å€™ï¼Œå°±ä¼šæ˜¯è°ƒç”¨å½“å‰è¯·æ±‚çš„ Controller ä¸­çš„æ–¹æ³•ã€‚</li>
<li><code>postHandle(HttpServletRequest request, HttpServletResponse response, Object handle, ModelAndView modelAndView)</code>æ–¹æ³•ï¼Œé€šè¿‡ preHandle æ–¹æ³•çš„è§£é‡Šå’±ä»¬çŸ¥é“è¿™ä¸ªæ–¹æ³•åŒ…æ‹¬åé¢è¦è¯´åˆ°çš„ afterCompletion æ–¹æ³•éƒ½åªèƒ½åœ¨å½“å‰æ‰€å±çš„ Interceptor çš„ preHandle æ–¹æ³•çš„è¿”å›å€¼ä¸º true çš„æ—¶å€™ï¼Œæ‰èƒ½è¢«è°ƒç”¨ã€‚postHandle æ–¹æ³•åœ¨å½“å‰è¯·æ±‚è¿›è¡Œå¤„ç†ä¹‹åï¼Œä¹Ÿå°±æ˜¯åœ¨ Controller ä¸­çš„æ–¹æ³•è°ƒç”¨ä¹‹åæ‰§è¡Œï¼Œä½†æ˜¯å®ƒä¼šåœ¨ DispatcherServlet è¿›è¡Œè§†å›¾è¿”å›æ¸²æŸ“ä¹‹å‰è¢«è°ƒç”¨ï¼Œæ‰€ä»¥å’±ä»¬å¯ä»¥åœ¨è¿™ä¸ªæ–¹æ³•ä¸­å¯¹ Controller å¤„ç†ä¹‹åçš„ ModelAndView å¯¹è±¡è¿›è¡Œæ“ä½œã€‚postHandle æ–¹æ³•è¢«è°ƒç”¨çš„æ–¹å‘è·Ÿ preHandle æ˜¯ç›¸åçš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå…ˆå£°æ˜çš„ Interceptor çš„ postHandle æ–¹æ³•åè€Œä¼šåæ‰§è¡Œã€‚è¿™å’Œ Struts2 é‡Œé¢çš„ Interceptor çš„æ‰§è¡Œè¿‡ç¨‹æœ‰ç‚¹ç±»å‹ï¼ŒStruts2 é‡Œé¢çš„ Interceptor çš„æ‰§è¡Œè¿‡ç¨‹ä¹Ÿæ˜¯é“¾å¼çš„ï¼Œåªæ˜¯åœ¨ Struts2 é‡Œé¢éœ€è¦æ‰‹åŠ¨è°ƒç”¨ ActionInvocation çš„ invoke æ–¹æ³•æ¥è§¦å‘å¯¹ä¸‹ä¸€ä¸ª Interceptor æˆ–è€…æ˜¯ action çš„è°ƒç”¨ï¼Œç„¶åæ¯ä¸€ä¸ª Interceptor ä¸­åœ¨ invoke æ–¹æ³•è°ƒç”¨ä¹‹å‰çš„å†…å®¹éƒ½æ˜¯æŒ‰ç…§å£°æ˜é¡ºåºæ‰§è¡Œçš„ï¼Œè€Œ invoke æ–¹æ³•ä¹‹åçš„å†…å®¹å°±æ˜¯åå‘çš„ã€‚</li>
<li><code>afterCompletion(HttpServletRequest request, HttpServletResponse response, Object handle, Exception ex)</code>æ–¹æ³•ï¼Œä¹Ÿæ˜¯éœ€è¦å½“å‰å¯¹åº”çš„ Interceptor çš„ preHandle æ–¹æ³•çš„è¿”å›å€¼ä¸º true æ—¶æ‰ä¼šæ‰§è¡Œã€‚å› æ­¤ï¼Œè¯¥æ–¹æ³•å°†åœ¨æ•´ä¸ªè¯·æ±‚ç»“æŸä¹‹åï¼Œä¹Ÿå°±æ˜¯åœ¨ DispatcherServlet æ¸²æŸ“äº†å¯¹åº”çš„è§†å›¾ä¹‹åæ‰§è¡Œï¼Œè¿™ä¸ªæ–¹æ³•çš„ä¸»è¦ä½œç”¨æ˜¯ç”¨äºè¿›è¡Œèµ„æºæ¸…ç†çš„å·¥ä½œã€‚</li>
</ul>
<p><!-- raw HTML omitted -->WebRequestInterceptoræ¥å£<!-- raw HTML omitted --></p>
<p>åœ¨WebRequestInterceptoræ¥å£ä¸­ä¹Ÿå®šä¹‰äº† 3 ä¸ªæ–¹æ³•ï¼Œæ–¹æ³•ååŒHandlerInterceptoræ¥å£ç›¸åŒï¼Œ3 ä¸ªæ–¹æ³•éƒ½ä¼ é€’äº†åŒä¸€ä¸ªå‚æ•° WebRequestã€‚WebRequest æ˜¯ Spring ä¸­å®šä¹‰çš„ä¸€ä¸ªæ¥å£ï¼Œå®ƒé‡Œé¢çš„æ–¹æ³•å®šä¹‰è·Ÿ HttpServletRequest ç±»ä¼¼ï¼Œåœ¨WebRequestInterceptorä¸­å¯¹ WebRequest è¿›è¡Œçš„æ‰€æœ‰æ“ä½œéƒ½å°†åŒæ­¥åˆ° HttpServletRequest ä¸­ï¼Œç„¶ååœ¨å½“å‰è¯·æ±‚ä¸­ä¾æ¬¡ä¼ é€’ã€‚</p>
<p>Springæ¡†æ¶ä¸­è¿˜æä¾›äº†WebRequestInterceptorAdapterï¼Œå…¶å®ç°äº†AsyncHandlerInterceptoræ¥å£ï¼Œå¹¶åœ¨å†…éƒ¨è°ƒç”¨äº†WebRequestInterceptoræ¥å£ã€‚</p>
<ul>
<li><code>preHandle(WebRequest request)</code>æ–¹æ³•ï¼Œè¯¥æ–¹æ³•åœ¨è¯·æ±‚å¤„ç†ä¹‹å‰è¿›è¡Œè°ƒç”¨ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå…¶ä¼šåœ¨ Controller ä¸­çš„æ–¹æ³•è°ƒç”¨ä¹‹å‰è¢«è°ƒç”¨ã€‚è¿™ä¸ªæ–¹æ³•è·Ÿ HandlerInterceptor ä¸­çš„ preHandle ä¸åŒï¼Œä¸»è¦åŒºåˆ«åœ¨äºè¯¥æ–¹æ³•çš„è¿”å›å€¼æ˜¯void ç±»å‹çš„ï¼Œä¹Ÿå°±æ˜¯æ²¡æœ‰è¿”å›å€¼ï¼Œå› æ­¤æˆ‘ä»¬ä¸»è¦ç”¨å®ƒæ¥è¿›è¡Œèµ„æºçš„å‡†å¤‡å·¥ä½œï¼Œæ¯”å¦‚æˆ‘ä»¬åœ¨ä½¿ç”¨ Hibernate çš„æ—¶å€™ï¼Œå¯ä»¥åœ¨è¿™ä¸ªæ–¹æ³•ä¸­å‡†å¤‡ä¸€ä¸ª Hibernate çš„Session å¯¹è±¡ï¼Œç„¶ååˆ©ç”¨ WebRequest çš„ setAttribute(name, value, scope) æŠŠå®ƒæ”¾åˆ° WebRequest çš„å±æ€§ä¸­ã€‚åœ¨è¿™é‡Œï¼Œè¿›ä¸€æ­¥è¯´è¯´ setAttribute æ–¹æ³•çš„ç¬¬ä¸‰ä¸ªå‚æ•° scope ï¼Œè¯¥å‚æ•°æ˜¯ä¸€ä¸ªInteger ç±»å‹çš„ã€‚åœ¨ WebRequest çš„çˆ¶å±‚æ¥å£ RequestAttributes ä¸­å¯¹å®ƒå®šä¹‰äº†ä¸‰ä¸ªå¸¸é‡ï¼Œåˆ†åˆ«ä¸ºï¼š
<ul>
<li>SCOPE_REQUEST ï¼Œå®ƒçš„å€¼æ˜¯ 0ï¼Œè¡¨ç¤ºåªæœ‰åœ¨ request ä¸­å¯ä»¥è®¿é—®ã€‚</li>
<li>SCOPE_SESSIONï¼Œå®ƒçš„å€¼æ˜¯1ï¼Œå¦‚æœç¯å¢ƒå…è®¸çš„è¯ï¼Œå®ƒè¡¨ç¤ºçš„æ˜¯ä¸€ä¸ªå±€éƒ¨çš„éš”ç¦»çš„ sessionï¼Œå¦åˆ™å°±ä»£è¡¨æ™®é€šçš„ sessionï¼Œå¹¶ä¸”åœ¨è¯¥ session èŒƒå›´å†…å¯ä»¥è®¿é—®ã€‚</li>
<li>SCOPE_GLOBAL_SESSIONï¼Œå®ƒçš„å€¼æ˜¯ 2ï¼Œå¦‚æœç¯å¢ƒå…è®¸çš„è¯ï¼Œå®ƒè¡¨ç¤ºçš„æ˜¯ä¸€ä¸ªå…¨å±€å…±äº«çš„ sessionï¼Œå¦åˆ™å°±ä»£è¡¨æ™®é€šçš„ sessionï¼Œå¹¶ä¸”åœ¨è¯¥ session èŒƒå›´å†…å¯ä»¥è®¿é—®ã€‚</li>
</ul>
</li>
<li><code>postHandle(WebRequest request, ModelMap model)</code>æ–¹æ³•ï¼Œè¯¥æ–¹æ³•åœ¨è¯·æ±‚å¤„ç†ä¹‹åï¼Œä¹Ÿå°±æ˜¯åœ¨ Controller ä¸­çš„æ–¹æ³•è°ƒç”¨ä¹‹åè¢«è°ƒç”¨ï¼Œä½†æ˜¯ä¼šåœ¨è§†å›¾è¿”å›è¢«æ¸²æŸ“ä¹‹å‰è¢«è°ƒç”¨ï¼Œæ‰€ä»¥å¯ä»¥åœ¨è¿™ä¸ªæ–¹æ³•é‡Œé¢é€šè¿‡æ”¹å˜æ•°æ®æ¨¡å‹ ModelMap æ¥æ”¹å˜æ•°æ®çš„å±•ç¤ºã€‚è¯¥æ–¹æ³•æœ‰ä¸¤ä¸ªå‚æ•°ï¼ŒWebRequest å¯¹è±¡æ˜¯ç”¨äºä¼ é€’æ•´ä¸ªè¯·æ±‚æ•°æ®çš„ï¼Œæ¯”å¦‚åœ¨ preHandle ä¸­å‡†å¤‡çš„æ•°æ®éƒ½å¯ä»¥é€šè¿‡ WebRequest æ¥ä¼ é€’å’Œè®¿é—®ï¼›ModelMap å°±æ˜¯ Controller å¤„ç†ä¹‹åè¿”å›çš„ Model å¯¹è±¡ï¼Œå’±ä»¬å¯ä»¥é€šè¿‡æ”¹å˜å®ƒçš„å±æ€§æ¥æ”¹å˜è¿”å›çš„ Model æ¨¡å‹ã€‚</li>
<li><code>afterCompletion(WebRequest request, Exception ex)</code>æ–¹æ³•ï¼Œè¯¥æ–¹æ³•ä¼šåœ¨æ•´ä¸ªè¯·æ±‚å¤„ç†å®Œæˆï¼Œä¹Ÿå°±æ˜¯åœ¨è§†å›¾è¿”å›å¹¶è¢«æ¸²æŸ“ä¹‹åæ‰§è¡Œã€‚å› æ­¤å¯ä»¥åœ¨è¯¥æ–¹æ³•ä¸­è¿›è¡Œèµ„æºçš„é‡Šæ”¾æ“ä½œã€‚è€Œ WebRequest å‚æ•°å°±å¯ä»¥æŠŠå’±ä»¬åœ¨ preHandle ä¸­å‡†å¤‡çš„èµ„æºä¼ é€’åˆ°è¿™é‡Œè¿›è¡Œé‡Šæ”¾ã€‚Exception å‚æ•°è¡¨ç¤ºçš„æ˜¯å½“å‰è¯·æ±‚çš„å¼‚å¸¸å¯¹è±¡ï¼Œå¦‚æœåœ¨ Controller ä¸­æŠ›å‡ºçš„å¼‚å¸¸å·²ç»è¢« Spring çš„å¼‚å¸¸å¤„ç†å™¨ç»™å¤„ç†äº†çš„è¯ï¼Œé‚£ä¹ˆè¿™ä¸ªå¼‚å¸¸å¯¹è±¡å°±æ˜¯æ˜¯ null.</li>
</ul>
<p><strong>æ¥æºï¼š<!-- raw HTML omitted -->ä½œè€…ï¼šç»´Cæœç³– | æ–‡ç« ï¼šè¿° Spring MVC æ¡†æ¶ä¸­æ‹¦æˆªå™¨ Interceptor çš„ä½¿ç”¨æ–¹æ³•<!-- raw HTML omitted --></strong></p>
<h2 id="æ‹¦æˆªå™¨code">æ‹¦æˆªå™¨CODE</h2>
<ol>
<li>
<p>å®ç°HandlerInterceptor æ¥å£</p>
<pre><code>    import cn.com.do1.component.core.shirocas.model.UserVO;
    import cn.com.do1.component.util.HttpPermissionUtil;
    import org.apache.shiro.SecurityUtils;
    import org.springframework.beans.factory.annotation.Value;
    import org.springframework.stereotype.Component;
    import org.springframework.web.servlet.HandlerInterceptor;
    import org.springframework.web.servlet.ModelAndView;

    import javax.servlet.http.HttpServletRequest;
    import javax.servlet.http.HttpServletResponse;
    import java.util.List;

    /**
     * ç‚¹å‡»èœå•æ‹¦æˆªå™¨
     * @author wm
     * @date 2018.10.29
     */
    @Component
    public class ClickMenuInterceptor implements HandlerInterceptor {

        @Value(&quot;${qxws.identifier}&quot;)
        private String systemId;

        @Override
        public boolean preHandle(HttpServletRequest request,
                                 HttpServletResponse response, Object handler) throws Exception {
            return true;
        }

        @Override
        public void postHandle(HttpServletRequest request,
                               HttpServletResponse response, Object handler,
                               ModelAndView modelAndView) throws Exception {
            UserVO user = (UserVO) SecurityUtils.getSubject().getSession().getAttribute(&quot;user&quot;);
            List&lt;String&gt; buttonList = HttpPermissionUtil.getButtonPermission(user.getUserId(), systemId);
            modelAndView.addObject(&quot;buttonList&quot;,buttonList);
        }

        @Override
        public void afterCompletion(HttpServletRequest request,
                                    HttpServletResponse response, Object handler, Exception ex)
                throws Exception {

        }

    } 
</code></pre><p>`</p>
</li>
<li>
<p>å®ç°WebRequestInterceptoræ¥å£</p>
<pre><code>    import org.springframework.ui.ModelMap;
    import org.springframework.web.context.request.WebRequest;
    import org.springframework.web.context.request.WebRequestInterceptor;

    /**
     * @author wm
     * @Description ClinkMenuInterceptor2
     * @date 2018/10/30 15:34
     * @Version 1.0
     */
    public class ClinkMenuInterceptor2 implements WebRequestInterceptor {
           
        @Override
        public void preHandle(WebRequest request) throws Exception {
               
        }

        @Override
        public void postHandle(WebRequest request, ModelMap model) throws Exception {

        }

        @Override
        public void afterCompletion(WebRequest request, Exception ex) throws Exception {

        }
    }

</code></pre><p>`</p>
</li>
<li>
<p>ç»§æ‰¿HandlerInterceptorAdapterç±»</p>
<pre><code>    import java.util.Arrays;
    import java.util.List;

    import javax.servlet.http.HttpServletRequest;
    import javax.servlet.http.HttpServletResponse;

    import org.springframework.stereotype.Component;
    import org.springframework.web.servlet.handler.HandlerInterceptorAdapter;
    /**
     * é”™è¯¯é¡µé¢æ‹¦æˆªå™¨
     * æ›¿ä»£EmbeddedServletContainerCustomizeråœ¨warä¸­ä¸èµ·ä½œç”¨çš„æ–¹æ³•
     * @author wm
     */
    @Component
    public class ErrorPageInterceptor extends HandlerInterceptorAdapter {
        private List&lt;Integer&gt; errorCodeList = Arrays.asList(404,500);
        @Override
        public boolean preHandle(HttpServletRequest request, HttpServletResponse response, Object handler) throws
            Exception {
           if (errorCodeList.contains(response.getStatus())) {
                response.sendRedirect(request.getContextPath()+&quot;/error/&quot; + response.getStatus());
                return false;
            }
            return super.preHandle(request, response, handler);
        }
    }
</code></pre><p>`</p>
</li>
</ol>
<h2 id="é…ç½®">é…ç½®</h2>
<ul>
<li>
<p>SpringMVC</p>
<pre><code>    &lt;!--æƒé™æ¥å…¥ï¼šæ‹¦æˆªå™¨--&gt;
    &lt;mvc:interceptors&gt;
        &lt;mvc:interceptor&gt;
            &lt;mvc:mapping path=&quot;/identitySource/goIdentitySourceList&quot;/&gt;
            &lt;mvc:mapping path=&quot;/userManager/goUserManagerListPage&quot;/&gt;
            &lt;mvc:mapping path=&quot;/schedulemgr/goScheduleListPage&quot;/&gt;
            &lt;bean class=&quot;cn.com.do1.component.security.interceptor.ClickMenuInterceptor&quot;/&gt;
        &lt;/mvc:interceptor&gt;
    &lt;/mvc:interceptors&gt;
</code></pre><pre><code>
</code></pre></li>
<li>
<p>SpringBoot</p>
<pre><code>    @Bean
    public ClickMenuInterceptor getClickMenuInterceptor() {
        return new ClickMenuInterceptor();
    }
    /**
     * æ–°å¢securityæ‹¦æˆªå™¨
     */
    @Override
    public void addInterceptors(InterceptorRegistry registry) {
        registry.addInterceptor(getClickMenuInterceptor()).
                addPathPatterns(&quot;/identitySource/goIdentitySourceList&quot;,
                        &quot;/userManager/goUserManagerListPage&quot;,
                        &quot;/schedulemgr/goScheduleListPage&quot;);
        super.addInterceptors(registry);
    }
</code></pre><pre><code>
</code></pre><pre><code>      @Autowired
      private ErrorPageInterceptor errorPageInterceptor;//é”™è¯¯æ‹¦æˆªå™¨ï¼ˆæ‹¦æˆª404ï¼Œ500ï¼‰
      /**
       * æ–°å¢æ‹¦æˆªå™¨
       */
      @Override
      public void addInterceptors(InterceptorRegistry registry) {
          registry.addInterceptor(errorPageInterceptor);//é»˜è®¤æ‹¦æˆªæ‰€æœ‰
          super.addInterceptors(registry);
      }
</code></pre><pre><code></code></pre></li>
</ul>

</section>


    <footer class="article-footer">
    
    <section class="article-tags">
        
            <a href="/tags/spring/">Spring</a>
        
    </section>


    
    <section class="article-copyright">
        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <path d="M14.5 9a3.5 4 0 1 0 0 6" />
</svg>



        <span>Licensed under CC BY-NC-SA 4.0</span>
    </section>
    </footer>

    
</article>

    <aside class="related-contents--wrapper">
    
    
        <h2 class="section-title">Related contents</h2>
        <div class="related-contents">
            <div class="flex article-list--tile">
                
                    
<article class="">
    <a href="/p/spring%E9%9D%A2%E8%AF%95%E9%A2%98/">
        
        

        <div class="article-details">
            <h2 class="article-title">Springé¢è¯•é¢˜</h2>
        </div>
    </a>
</article>
                
                    
<article class="">
    <a href="/p/spring%E5%B8%B8%E7%94%A8%E6%B3%A8%E8%A7%A3/">
        
        

        <div class="article-details">
            <h2 class="article-title">Springå¸¸ç”¨æ³¨è§£</h2>
        </div>
    </a>
</article>
                
                    
<article class="">
    <a href="/p/springmvc%E7%9A%84%E8%BF%90%E8%A1%8C%E6%B5%81%E7%A8%8B%E5%8F%8A%E4%B9%9D%E5%A4%A7%E7%BB%84%E4%BB%B6/">
        
        

        <div class="article-details">
            <h2 class="article-title">SpringMVCçš„è¿è¡Œæµç¨‹åŠä¹å¤§ç»„ä»¶</h2>
        </div>
    </a>
</article>
                
                    
<article class="">
    <a href="/p/springboot%E5%88%9D%E4%BD%93%E9%AA%8C/">
        
        

        <div class="article-details">
            <h2 class="article-title">SpringBootåˆä½“éªŒ</h2>
        </div>
    </a>
</article>
                
            </div>
        </div>
    
</aside>


    
        
    <div class="disqus-container">
    <div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "hugo-theme-stack" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</div>

<style>
    .disqus-container {
        background-color: var(--card-background);
        border-radius: var(--card-border-radius);
        box-shadow: var(--shadow-l1);
        padding: var(--card-padding);
    }
</style>


    

    <footer class="site-footer">
    <section class="copyright">
        &copy; 
        
        2020 å´ç‚œæ£‰
    </section>
    
    <section class="powerby">
        Built with <a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a> <br />
        Theme <b><a href="https://github.com/CaiJimmy/hugo-theme-stack" target="_blank" rel="noopener" data-version="2.0.0">Stack</a></b> designed by <a href="https://jimmycai.com" target="_blank" rel="noopener">Jimmy</a>
    </section>
</footer>
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    
    <div class="pswp__bg"></div>

    
    <div class="pswp__scroll-wrap">

        
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                
                
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div>

<script src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js"></script>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.css">
            </main>
        </div>
        <script src="https://cdn.jsdelivr.net/npm/node-vibrant@3.1.5/dist/vibrant.min.js"
    integrity="sha256-5NovOZc4iwiAWTYIFiIM7DxKUXKWvpVEuMEPLzcm5/g=" crossorigin="anonymous"></script><script type="text/javascript" src="/ts/main.js" defer></script>
<script>
    (function () {
        const customFont = document.createElement('link');
        customFont.href = "https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap";

        customFont.type = "text/css";
        customFont.rel = "stylesheet";

        document.head.appendChild(customFont);
    }());
</script>

    </body>
</html>
