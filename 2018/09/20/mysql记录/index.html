<!DOCTYPE html>
<html lang="zh" itemscope itemtype="http://schema.org/WebPage">
<head>
  <meta name="generator" content="Hugo 0.48" />
  <meta charset="utf-8">
  <title>MySQL记录 · IanEiU</title>
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="字符编码使用utf8mb4 MySQL数据库的 “utf8”并不是真正概念里的 UTF-8。MySQL中的“utf8”编码只支持最大3字节每字符。" />

  <meta name="keywords" content="Hugo, theme, ianeiu, 吴炜棉" />

<link rel="canonical" href="https://ianeiu.github.io/2018/09/20/mysql%E8%AE%B0%E5%BD%95/" />

<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.2.0/css/all.css" integrity="sha384-hWVjflwFxL6sNzntih27bfxkr27PmbbK/iSvJ+a4+0owXq79v+lsFkW54bOGbiDQ" crossorigin="anonymous">
<link rel="stylesheet" href="https://ianeiu.github.io/css/den.css">

<link rel="stylesheet" href="https://ianeiu.github.io/css/custom.css">




<meta property="og:title" content="MySQL记录" />
<meta property="og:description" content="字符编码使用utf8mb4 MySQL数据库的 “utf8”并不是真正概念里的 UTF-8。MySQL中的“utf8”编码只支持最大3字节每字符。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://ianeiu.github.io/2018/09/20/mysql%E8%AE%B0%E5%BD%95/" /><meta property="article:published_time" content="2018-09-20T00:00:00&#43;00:00"/>
<meta property="article:modified_time" content="2018-09-20T00:00:00&#43;00:00"/>
<meta itemprop="name" content="MySQL记录">
<meta itemprop="description" content="字符编码使用utf8mb4 MySQL数据库的 “utf8”并不是真正概念里的 UTF-8。MySQL中的“utf8”编码只支持最大3字节每字符。">


<meta itemprop="datePublished" content="2018-09-20T00:00:00&#43;00:00" />
<meta itemprop="dateModified" content="2018-09-20T00:00:00&#43;00:00" />
<meta itemprop="wordCount" content="1537">



<meta itemprop="keywords" content="MySQL," />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="MySQL记录"/>
<meta name="twitter:description" content="字符编码使用utf8mb4 MySQL数据库的 “utf8”并不是真正概念里的 UTF-8。MySQL中的“utf8”编码只支持最大3字节每字符。"/>
</head>
<body>
  
  <div class="header-container" style="background: linear-gradient(rgba(0, 0, 0, 0.2), rgba(0, 0, 0, 0.2)), url('https://ianeiu.github.io/images/bg3.jpg'); background-position: center; background-size: cover;">
  <div class="container">
  <nav class="header-nav navbar navbar-expand-md navbar-dark light-dark">
    <div class="header-logo navbar-brand">
      
        <a class="float-left" href="https://ianeiu.github.io/">
      
        
        <img class="mr20 header-logo-image" src="https://ianeiu.github.io/images/avatar.ico" alt="logo">
        
        
          IanEiU
         
      </a>
    </div>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="nav-menu collapse navbar-collapse" id="navbarNav">
      <ul class="navbar-nav">
        
          <li class="nav-item">
            
              
                <a class="nav-link" href="https://ianeiu.github.io/">All</a>
              
            
          </li>
        
          <li class="nav-item">
            
              
                <a class="nav-link" href="https://ianeiu.github.io/categories">分类</a>
              
            
          </li>
        
          <li class="nav-item">
            
              
                <a class="nav-link" href="https://ianeiu.github.io/tags">标签</a>
              
            
          </li>
        
          <li class="nav-item">
            
              
                <a class="nav-link" href="https://ianeiu.github.io/category/java/">Java</a>
              
            
          </li>
        
          <li class="nav-item">
            
              <a class="nav-link" href="https://ianeiu.github.io/about/">About</a>
            
          </li>
        
        
      </ul>
    </div>
  </nav>
</div>

<div class="container header-wrapper">
  <div class="row">
    <div class="col-lg-12">
      <div class="header-content">
        <h1 class="header-title">MySQL记录</h1>
        <p class="header-date">作者：
          吴炜棉 /
        
        2018-09-20
          / 分类：
          <a href="https://ianeiu.github.io/category/mysql/">MySQL</a>
        </p>
        
        <div class="header-underline"></div>
        
          <div class="clearfix"></div>
          <p class="float-right header-tags">
              <i class="fas fa-tags" aria-hidden="true"></i>
              <a href="https://ianeiu.github.io/tag/mysql/">MySQL</a>
          </p>
        
        

      </div>
    </div>
  </div>
</div>

  </div>
  <main>
<div class="container content">
  <article>
  

<h2 id="字符编码使用-utf8mb4">字符编码使用<code>utf8mb4</code></h2>

<p>MySQL数据库的 “utf8”并不是真正概念里的 UTF-8。MySQL中的“utf8”编码只支持最大3字节每字符。真正的大家正在使用的UTF-8编码是应该能支持4字节每个字符。</p>

<p>MySQL的开发者没有修复这个bug。他们在2010年增加了一个变通的方法：一个新的字符集“utf8mb4”</p>

<h2 id="外键">外键</h2>

<ul>
<li>cascade方式
在父表上update/delete记录时，同步update/delete掉子表的匹配记录</li>
<li>set null方式
在父表上update/delete记录时，将子表上匹配记录的列设为null
要注意子表的外键列不能为not null<br /></li>
<li>No action方式
如果子表中有匹配的记录,则不允许对父表对应候选键进行update/delete操作<br /></li>
<li>Restrict方式
同no action, 都是立即检查外键约束</li>
<li>Set default方式
父表有变更时,子表将外键列设置成一个默认的值 但Innodb不能识别</li>
</ul>

<h2 id="bool">bool</h2>

<p>mysql是不支持bool类型的,所以,当把一个数据设置成bool类型的时候,数据库会自动转换成tinyint(1)的数据类型,其实这个就是变相的bool。<br />
默认值也就是1,0两种,分别对应了bool的true和false</p>

<h2 id="修改connect-timeout全局变量">修改connect_timeout全局变量</h2>

<ol>
<li>查询匹配“timeout”的全局变量  <code>show global variables like '%timeout%';</code></li>
<li>设置全局变量connect_timeout为100秒  <code>SET GLOBAL connect_timeout = 100;</code></li>
<li>再次查看，确认参数是否修改成功  <code>show global variables like '%timeout%';</code></li>
</ol>

<h2 id="建索引的几大原则">建索引的几大原则</h2>

<ol>
<li>最左前缀匹配原则，非常重要的原则，mysql会一直向右匹配直到遇到范围查询(&gt;、&lt;、between、like)就停止匹配。比如a = 1 and b = 2 and c &gt; 3 and d = 4 如果建立(a,b,c,d)顺序的索引，d是用不到索引的，如果建立(a,b,d,c)的索引则都可以用到，a,b,d的顺序可以任意调整。</li>
<li>=和in可以乱序，比如a = 1 and b = 2 and c = 3 建立(a,b,c)索引可以任意顺序，mysql的查询优化器会帮你优化成索引可以识别的形式</li>
<li>尽量选择区分度高的列作为索引,区分度的公式是count(distinct col)/count(*)，表示字段不重复的比例，比例越大我们扫描的记录数越少，唯一键的区分度是1，而一些状态、性别字段可能在大数据面前区分度就是0，那可能有人会问，这个比例有什么经验值吗？使用场景不同，这个值也很难确定，一般需要join的字段我们都要求是0.1以上，即平均1条扫描10条记录</li>
<li>索引列不能参与计算，保持列“干净”。比如from_unixtime(create_time) = ’2014-05-29’就不能使用到索引，原因很简单，b+树中存的都是数据表中的字段值，但进行检索时，需要把所有元素都应用函数才能比较，显然成本太大。所以语句应该写成create_time = unix_timestamp(’2014-05-29’);</li>
<li>尽量的扩展索引，不要新建索引。比如表中已经有a的索引，现在要加(a,b)的索引，那么只需要修改原来的索引即可。</li>
</ol>

<h2 id="sql调优">SQL调优</h2>

<p><a href="https://www.cnblogs.com/tangyanbo/p/4462734.html" target="_blank">一次非常有意思的sql优化经历</a></p>

<ol>
<li>列类型尽量定义成数值类型，且长度尽可能短，如主键和外键，类型字段等等</li>
<li>mysql嵌套子查询效率确实比较低，可以优化成连接查询</li>
<li>连接表时，可以先用where条件对表进行过滤，然后做表连接</li>
<li>建立单列索引</li>
<li>根据需要建立多列联合索引

<ul>
<li>当单个列过滤之后还有很多数据，那么索引的效率将会比较低，即列的区分度较低，</li>
<li>那么如果在多个列上建立索引，那么多个列的区分度就大多了，将会有显著的效率提高。</li>
</ul></li>
<li>根据业务场景建立覆盖索引

<ul>
<li>只查询业务需要的字段，如果这些字段被索引覆盖，将极大的提高查询效率</li>
</ul></li>
<li>多表连接的字段上需要建立索引</li>
<li>where条件字段、排序字段、分组字段上需要建立索引</li>
<li>where条件上不要使用运算函数，以免索引失效</li>
</ol>

  </article>

  
  
    
    
    
  
  


</div>

  </main><div class="footer gradient-2">
  <div class="container footer-container ">
    <div class="row">
      <div class="col-xs-4 col-sm-3 col-md-3 col-lg-3">
        <div class="footer-title">网站地图</div>
        <ul class="list-unstyled">
            
              
                <li><a href="https://ianeiu.github.io/tags/">标签</a></li>
              
              
                <li><a href="https://ianeiu.github.io/categories/">分类</a></li>
              
            
            
            
            <li><a rel="alternate" type="application/rss&#43;xml" href="https://ianeiu.github.io/index.xml"><i class="fas fa-rss-square"></i> RSS订阅</a></li>
            
            
            
        </ul>
      </div>
      <div class="col-xs-4 col-sm-3 col-md-3 col-lg-3">
        
        <div class="footer-title">社交</div>
        <ul class="list-unstyled">
          
          <li><a href="https://github.com/ianeiu" rel="noopener" target="_blank">GitHub</a></li>
          
        </ul>
        
      </div>
      <div class="col-xs-4 col-sm-3 col-md-3 col-lg-3">
        
        <div class="footer-title">链接</div>
        <ul class="list-unstyled">
          
          <li><a href="https://github.com/ianeiu" rel="noopener" target="_blank">关于我</a></li>
          
        </ul>
        
      </div> 
      <div class="col-xs-12 col-sm-3 col-md-3 col-lg-3">
        <p class="pull-right text-right">
          <small><em>Proudly powered by <a href="https://gohugo.io/" rel="noopener" target="_blank">Hugo</a></em></small><br/>
          <small><em>Theme - <a href="https://github.com/shaform/hugo-theme-den" rel="noopener" target="_blank">Den</a></em></small><br/>
          <small>
            &copy; 
            WuWeiMian
            
              2018 -
            2020
          </small>
          
        </p>
      </div>
    </div>
  </div>
</div>
<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>

</body>
</html>
